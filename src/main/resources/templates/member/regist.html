<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
  <meta charset="UTF-8">
  <title>회원가입</title>

  <link rel="stylesheet" type="text/css" th:href="@{/css/main/regist.css}">

  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>

  <!-- S: signup -->
  <div class="signup">
    <div class="signup-form">

        <h1>SIGNUP</h1>
        <form id="joinForm" th:action="@{/member/regist}" method="post">
          <div class="input-box">
            <label for="duplicationCheck" maxlength="13" class="required">아이디</label>
            <input type="text" maxlength="13" name="memberId" id="memberId" required>
            <input style="width: 120px" type="button" value="중복확인" class="btn btn-yg" id="duplicationCheck">
          </div>

          <div class="input-box">
            <label for="memberPwd" class="required">비밀번호</label>
            <input type="password" maxlength="13" name="memberPwd" id="memberPwd" required />
          </div>

          <div class="input-box">
            <label for="memberPwd2" class="required">비밀번호 확인</label>
            <input type="password" maxlength="13" name="memberPwd2" id="memberPwd2" />
          </div>

          <div class="input-box">
            <label for="nickname" class="required">닉네임</label>
            <input type="text" maxlength="5" name="nickname" id="nickname" />
          </div>

          <div class="input-box">
            <label for="phone">연락처</label>
            <input type="text" name="phone" id="phone" />
          </div>

          <div class="input-box">
            <label for="email">이메일</label>
            <input type="email" name="email" id="email" />
          </div>

          <div class="input-box">
            <label for="zipCode">우편번호</label>
            <input type="text" name="zipCode" id="zipCode" readonly />
            <input style="width: 120px" type="button" value="검색" class="btn btn-yg" id="searchZipCode">
          </div>

          <div class="input-box">
            <label for="address1">주소</label>
            <input type="text" name="address1" id="address1" readonly />
          </div>

          <div class="input-box">
            <label for="address2">상세주소</label>
            <input type="text" name="address2" id="address2" />
          </div>

        <div class="input-box-outer">

          <div class="cta-outer">
            <input type="button" class="btn-back" value="돌아가기" id="goMain"/>
            <input type="submit" value="가입하기" class="btn-submit">
          </div>
        </div>
      </form>
    </div>
  </div>
  <!-- E: signup -->

</body>

<script th:inline="javascript">

  const $searchZipCode = document.getElementById("searchZipCode");
  const $goMain = document.getElementById("goMain");

  $searchZipCode.onclick = function() {

    /* 다음 우편번호 검색 창을 오픈하면서 동작할 콜백 메소드를 포함한 객체를 매개변수로 전달한다. */
    new daum.Postcode({
      oncomplete: function(data){
        /* 팝업에서 검색결과 항목을 클릭했을 시 실행할 코드를 작성하는 부분 */
        document.getElementById("zipCode").value = data.zonecode;
        document.getElementById("address1").value = data.address;
        document.getElementById("address2").focus();
      }
    }).open();
  }

  $goMain.onclick = function() {
    location.href = "/";
  }

</script>
<script>
  if(document.getElementById("duplicationCheck")) {

    const $duplication = document.getElementById("duplicationCheck");

    $duplication.onclick = function() {
      let memberId = document.getElementById("memberId").value.trim();

      fetch("/member/idDupCheck", {
        method: "POST",
        headers: {
          'Content-Type': 'application/json;charset=UTF-8'
        },
        body: JSON.stringify({memberId: memberId})
      })
              .then(result => result.text())
              .then(result => alert(result))
              .catch((error) => error.text().then((res) => alert(res)));

    }
  }
</script>
</html>